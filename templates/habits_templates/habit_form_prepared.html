{% load crispy_forms_tags %}
<div class="container mt-4">
  <form
    id="habit-form"
    method="post"
    class="{% if not template %}d-none{% endif %}"
    style="
      background-color: var(--card-bg);
      color: var(--text-color);
      border: 1px solid var(--card-border);
      border-radius: 0.25rem;
      padding: 1rem;
    "
  >
    {% csrf_token %}
    {{ form|crispy }}

    {% if template == 'stop_smoking' %}
    <div
      class="extra-fields mt-4"
      style="
        background-color: var(--input-bg);
        border-radius: 0.25rem;
        padding: 1rem;
      "
    >
      <h5 style="color: var(--text-color);">Additional Details for Stopping Smoking</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label
            for="cigarettes_per_day"
            style="color: var(--text-color);"
            class="form-label"
          >
            Cigarettes per Day
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="How many cigarettes on average do you smoke daily?"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Average smoked daily
          </small>
          <input
            type="number"
            name="cigarettes_per_day"
            id="cigarettes_per_day"
            class="form-control"
            placeholder="e.g. 10"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label
            for="craving_level"
            style="color: var(--text-color);"
            class="form-label"
          >
            Craving Level (1-10)
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Rate your current cravings on a scale of 1 to 10"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Rate your current cravings
          </small>
          <input
            type="number"
            name="craving_level"
            id="craving_level"
            class="form-control"
            min="1"
            max="10"
            placeholder="e.g. 7"
          />
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label
            for="planned_quit_date"
            style="color: var(--text-color);"
            class="form-label"
          >
            Planned Quit Date
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="When do you plan to stop smoking completely?"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            When do you want to stop completely?
          </small>
          <input
            type="date"
            name="planned_quit_date"
            id="planned_quit_date"
            class="form-control"
            placeholder="mm/dd/yyyy"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label
            for="nicotine_replacement"
            style="color: var(--text-color);"
            class="form-label"
          >
            Nicotine Replacement
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="List any patches, gum, or other replacements you use"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Patches, gum, etc. (if any)
          </small>
          <input
            type="text"
            name="nicotine_replacement"
            id="nicotine_replacement"
            class="form-control"
            placeholder="e.g. Nicotine Gum"
          />
        </div>
      </div>

      <div class="mb-3">
        <label
          for="trigger_coping"
          style="color: var(--text-color);"
          class="form-label"
        >
          Triggers & Coping Strategies
          <span
            class="ms-2"
            data-bs-toggle="tooltip"
            data-bs-title="Identify your triggers and how you handle them"
            style="cursor: pointer;"
          >
            <i class="bi bi-exclamation-circle-fill"></i>
          </span>
        </label>
        <small
          style="color: var(--text-color);"
          class="d-block mb-1"
        >
          Identify triggers & how you handle them
        </small>
        <input
          type="text"
          name="trigger_coping"
          id="trigger_coping"
          class="form-control"
          placeholder="e.g. Deep breathing for stress"
        />
      </div>
    </div>
    {% elif template == 'wake_up_early' %}
    <div
      class="extra-fields mt-4"
      style="
        background-color: var(--input-bg);
        border-radius: 0.25rem;
        padding: 1rem;
      "
    >
      <h5 style="color: var(--text-color);">Additional Details for Waking Up Early</h5>
      <div class="row">
        <div class="col-md-4 mb-3">
          <label
            for="current_wake_time"
            style="color: var(--text-color);"
            class="form-label"
          >
            Current Wake Time
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Usual time you get out of bed"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Usual time you get out of bed
          </small>
          <input
            type="time"
            name="current_wake_time"
            class="form-control"
            placeholder="e.g. 07:30"
          />
        </div>
        <div class="col-md-4 mb-3">
          <label
            for="desired_wake_time"
            style="color: var(--text-color);"
            class="form-label"
          >
            Desired Wake Time
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="What time do you want to wake up?"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Target time to wake up
          </small>
          <input
            type="time"
            name="desired_wake_time"
            class="form-control"
            placeholder="e.g. 06:00"
          />
        </div>
        <div class="col-md-4 mb-3">
          <label
            for="bedtime"
            style="color: var(--text-color);"
            class="form-label"
          >
            Bedtime
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Usual time you go to bed"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Usual time you go to bed
          </small>
          <input
            type="time"
            name="bedtime"
            class="form-control"
            placeholder="e.g. 22:30"
          />
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label
            for="sleep_quality"
            style="color: var(--text-color);"
            class="form-label"
          >
            Sleep Quality (1-10)
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Rate how well you usually sleep"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Rate how well you usually sleep
          </small>
          <input
            type="number"
            name="sleep_quality"
            min="1"
            max="10"
            class="form-control"
            placeholder="e.g. 8"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label
            for="snooze_count"
            style="color: var(--text-color);"
            class="form-label"
          >
            Number of Snoozes
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Times you hit the snooze button"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Times you hit the snooze button
          </small>
          <input
            type="number"
            name="snooze_count"
            min="0"
            class="form-control"
            placeholder="e.g. 2"
          />
        </div>
      </div>
    </div>
    {% elif template == 'eat_healthy' %}
    <div
      class="extra-fields mt-4"
      style="
        background-color: var(--input-bg);
        border-radius: 0.25rem;
        padding: 1rem;
      "
    >
      <h5 style="color: var(--text-color);">Additional Details for Eating Healthy</h5>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label
            for="daily_calorie_target"
            style="color: var(--text-color);"
            class="form-label"
          >
            Daily Calorie Target
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Approximate calories you want to consume daily"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Approximate calories per day
          </small>
          <input
            type="number"
            name="daily_calorie_target"
            min="0"
            class="form-control"
            placeholder="e.g. 2000"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label
            for="fruit_veg_target"
            style="color: var(--text-color);"
            class="form-label"
          >
            Fruit & Veg Servings
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="How many servings of fruits/veggies you aim for"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Number of servings you aim for
          </small>
          <input
            type="number"
            name="fruit_veg_target"
            min="0"
            class="form-control"
            placeholder="e.g. 5"
          />
        </div>
      </div>
      <div class="row">
        <div class="col-md-6 mb-3">
          <label
            for="water_intake_goal"
            style="color: var(--text-color);"
            class="form-label"
          >
            Water Intake (glasses/day)
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="Daily water intake goal in glasses"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            How many glasses of water daily
          </small>
          <input
            type="number"
            name="water_intake_goal"
            min="0"
            class="form-control"
            placeholder="e.g. 8"
          />
        </div>
        <div class="col-md-6 mb-3">
          <label
            for="junk_food_consumption"
            style="color: var(--text-color);"
            class="form-label"
          >
            Junk Food Consumption
            <span
              class="ms-2"
              data-bs-toggle="tooltip"
              data-bs-title="How often you have junk or fast food"
              style="cursor: pointer;"
            >
              <i class="bi bi-exclamation-circle-fill"></i>
            </span>
          </label>
          <small
            style="color: var(--text-color);"
            class="d-block mb-1"
          >
            Frequency of snacks or junk meals
          </small>
          <input
            type="number"
            name="junk_food_consumption"
            min="0"
            class="form-control"
            placeholder="e.g. 2"
          />
        </div>
      </div>
    </div>
    {% endif %}

    <div
      class="mt-4"
      style="
        background-color: var(--input-bg);
        border-radius: 0.25rem;
        padding: 1rem;
      "
    >
      <h5 style="color: var(--text-color);">Add Custom Fields (optional)</h5>
      <small style="color: var(--text-color);" class="d-block mb-2">
        Track any extra data you want
      </small>
      <div id="customFieldsContainer"></div>
      <button
        type="button"
        class="btn btn-dark mt-2"
        id="addCustomField"
      >
        Add Field
      </button>
    </div>

    <div
      class="mt-4"
      style="
        background-color: var(--input-bg);
        border-radius: 0.25rem;
        padding: 1rem;
      "
    >
      <h5 style="color: var(--text-color);">How This System Works</h5>
      <p style="color: var(--text-color);">
        By creating a new habit, you'll earn points each day you stick to it.
        If you meet your goals (e.g. 5 days in a row), you'll unlock achievements.
        This gamification approach keeps you motivated.
      </p>
    </div>
    <button
      id="confirmPresetBtn"
      type="submit"
      class="btn btn-primary w-100 mt-3"
    >
      Confirm
    </button>
  </form>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('habit-form');
  if ("{{ template }}") {
    form.classList.remove('d-none');
  }
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  tooltipTriggerList.map(function (tooltipTriggerEl) {
    return new bootstrap.Tooltip(tooltipTriggerEl);
  });
});
</script>
